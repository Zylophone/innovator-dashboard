!function(){"use strict";var t={init:function(){this._getOptions(),document.getElementById("options").addEventListener("submit",this.saveOptions)},_setTasklists:function(t){chrome.identity.getAuthToken({interactive:!0},function(e){var s="https://www.googleapis.com/tasks/v1/users/@me/lists",n=new XMLHttpRequest;n.open("GET",s,!0),n.setRequestHeader("Authorization","Bearer "+e),n.onload=function(){if(n.status>=200&&n.status<400){var e=JSON.parse(n.responseText).items.map(function(t){return'<option value="'+t.id+'">'+t.title+"</option>"});document.getElementById("tasklists").innerHTML=e.join(""),document.getElementById("tasklists").value=t}},n.send()})},_getOptions:function(){chrome.storage.sync.get({tasklist:""},function(e){t._setTasklists(e.tasklist),document.getElementById("calendars").value=e.calendar})},_getTasks:function(t){chrome.identity.getAuthToken({interactive:!0},function(e){var s="https://www.googleapis.com/tasks/v1/lists/"+t+"/tasks",n=new XMLHttpRequest;n.open("GET",s,!0),n.setRequestHeader("Authorization","Bearer "+e),n.onload=function(){if(n.status>=200&&n.status<400){var t=JSON.parse(n.responseText).items;console.log(t);var e=t.map(function(t){if(t.links)var e=t.links.map(function(t){return t.link});else var e=[];return{title:t.title,completed:t.completed||!1,notes:t.notes||null,link:e}});chrome.storage.sync.set({todos:e},function(){window.close()})}},n.send()})},saveOptions:function(e){e.preventDefault(),t._getTasks(e.target[0].value),chrome.storage.sync.set({tasklist:e.target[0].value,calendar:encodeURIComponent(e.target[1].value)})}};t.init()}();