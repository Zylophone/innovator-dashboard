angular.module("todomvc",["ngRoute","ngResource","ngSanitize"]).config(["$routeProvider","$sceDelegateProvider",function(o,e){"use strict";var t={controller:"TodoCtrl",templateUrl:"todomvc-index.html",resolve:{store:["todoStorage",function(o){return o.then(function(o){return o.get(),o})}]}};o.when("/",t).when("/:status",t).otherwise({redirectTo:"/"}),e.resourceUrlWhitelist(["self","*://calendar.google.com/calendar/**"])}]),angular.module("todomvc").controller("TodoCtrl",["$scope","$routeParams","$filter","store","$sce",function(o,e,t,n,r){"use strict";var i=o.todos=n.todos;console.log(i),chrome.storage.sync.get({calendar:"",tasklist:""},function(e){o.calendarSrc="https://calendar.google.com/calendar/embed?src="+e.calendar,o.calendar=r.trustAsResourceUrl(o.calendarSrc),o.$apply()}),o.newTodo="",o.editedTodo=null,o.$watch("todos",function(){o.remainingCount=t("filter")(i,{completed:!1}).length,o.completedCount=i.length-o.remainingCount,o.allChecked=!o.remainingCount},!0),o.$on("$routeChangeSuccess",function(){var t=o.status=e.status||"";o.statusFilter="active"===t?{completed:!1}:"completed"===t?{completed:!0}:{}}),o.addTodo=function(){var e={title:o.newTodo.trim(),completed:!1};e.title&&(o.saving=!0,n.insert(e).then(function(){o.newTodo=""}).finally(function(){o.saving=!1}))},o.editTodo=function(e){o.editedTodo=e,o.originalTodo=angular.extend({},e)},o.saveEdits=function(e,t){return"blur"===t&&"submit"===o.saveEvent?void(o.saveEvent=null):(o.saveEvent=t,o.reverted?void(o.reverted=null):(e.title=e.title.trim(),e.title===o.originalTodo.title?void(o.editedTodo=null):void n[e.title?"put":"delete"](e).then(function(){},function(){e.title=o.originalTodo.title}).finally(function(){o.editedTodo=null})))},o.revertEdits=function(e){i[i.indexOf(e)]=o.originalTodo,o.editedTodo=null,o.originalTodo=null,o.reverted=!0},o.removeTodo=function(o){n.delete(o)},o.saveTodo=function(o){n.put(o)},o.toggleCompleted=function(o,e){angular.isDefined(e)&&(o.completed=e),n.put(o,i.indexOf(o)).then(function(){},function(){o.completed=!o.completed})},o.clearCompletedTodos=function(){n.clearCompleted()},o.markAll=function(e){i.forEach(function(t){t.completed!==e&&o.toggleCompleted(t,e)})}}]),angular.module("todomvc").factory("todoStorage",["$http","$injector",function(o,e){"use strict";return o.get("/api").then(function(){return e.get("api")},function(){return e.get("localStorage")})}]).factory("api",["$resource",function(o){"use strict";var e={todos:[],api:o("/api/todos/:id",null,{update:{method:"PUT"}}),clearCompleted:function(){var o=e.todos.slice(0),t=e.todos.filter(function(o){return!o.completed});return angular.copy(t,e.todos),e.api.delete(function(){},function(){angular.copy(o,e.todos)})},delete:function(o){var t=e.todos.slice(0);return e.todos.splice(e.todos.indexOf(o),1),e.api.delete({id:o.id},function(){},function(){angular.copy(t,e.todos)})},get:function(){return e.api.query(function(o){angular.copy(o,e.todos)})},insert:function(o){var t=e.todos.slice(0);return e.api.save(o,function(t){o.id=t.id,e.todos.push(o)},function(){angular.copy(t,e.todos)}).$promise},put:function(o){return e.api.update({id:o.id},o).$promise}};return e}]).factory("localStorage",["$q",function(o){"use strict";var e={todos:[],_getFromLocalStorage:function(){var e=o.defer();return chrome.storage.sync.get({todos:[]},function(o){e.resolve(o.todos)}),e.promise},_saveToLocalStorage:function(o){chrome.storage.sync.set({todos:o})},clearCompleted:function(){var t=o.defer(),n=e.todos.filter(function(o){return!o.completed});return angular.copy(n,e.todos),e._saveToLocalStorage(e.todos),t.resolve(e.todos),t.promise},delete:function(t){var n=o.defer();return e.todos.splice(e.todos.indexOf(t),1),e._saveToLocalStorage(e.todos),n.resolve(e.todos),n.promise},get:function(){var t=o.defer();return e._getFromLocalStorage().then(function(o){angular.copy(o,e.todos),t.resolve(e.todos)}),t.promise},insert:function(t){var n=o.defer();return e.todos.push(t),e._saveToLocalStorage(e.todos),n.resolve(e.todos),n.promise},put:function(t,n){var r=o.defer();return e.todos[n]=t,e._saveToLocalStorage(e.todos),r.resolve(e.todos),r.promise}};return e}]),angular.module("todomvc").directive("todoFocus",["$timeout",function(o){"use strict";return function(e,t,n){e.$watch(n.todoFocus,function(e){e&&o(function(){t[0].focus()},0,!1)})}}]),angular.module("todomvc").directive("todoEscape",[function(){"use strict";var o=27;return function(e,t,n){t.bind("keydown",function(t){t.keyCode===o&&e.$apply(n.todoEscape)}),e.$on("$destroy",function(){t.unbind("keydown")})}}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsInRvZG9DdHJsLmpzIiwidG9kb1N0b3JhZ2UuanMiLCJ0b2RvRm9jdXMuanMiLCJ0b2RvRXNjYXBlLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCIkcm91dGVQcm92aWRlciIsIiRzY2VEZWxlZ2F0ZVByb3ZpZGVyIiwicm91dGVDb25maWciLCJjb250cm9sbGVyIiwidGVtcGxhdGVVcmwiLCJyZXNvbHZlIiwic3RvcmUiLCJ0b2RvU3RvcmFnZSIsInRoZW4iLCJnZXQiLCJ3aGVuIiwib3RoZXJ3aXNlIiwicmVkaXJlY3RUbyIsInJlc291cmNlVXJsV2hpdGVsaXN0IiwiJHNjb3BlIiwiJHJvdXRlUGFyYW1zIiwiJGZpbHRlciIsIiRzY2UiLCJ0b2RvcyIsImNvbnNvbGUiLCJsb2ciLCJjaHJvbWUiLCJzdG9yYWdlIiwic3luYyIsImNhbGVuZGFyIiwidGFza2xpc3QiLCJpdGVtcyIsImNhbGVuZGFyU3JjIiwidHJ1c3RBc1Jlc291cmNlVXJsIiwiJGFwcGx5IiwibmV3VG9kbyIsImVkaXRlZFRvZG8iLCIkd2F0Y2giLCJyZW1haW5pbmdDb3VudCIsImNvbXBsZXRlZCIsImxlbmd0aCIsImNvbXBsZXRlZENvdW50IiwiYWxsQ2hlY2tlZCIsIiRvbiIsInN0YXR1cyIsInN0YXR1c0ZpbHRlciIsImFkZFRvZG8iLCJ0aXRsZSIsInRyaW0iLCJzYXZpbmciLCJpbnNlcnQiLCJmaW5hbGx5IiwiZWRpdFRvZG8iLCJ0b2RvIiwib3JpZ2luYWxUb2RvIiwiZXh0ZW5kIiwic2F2ZUVkaXRzIiwiZXZlbnQiLCJzYXZlRXZlbnQiLCJyZXZlcnRlZCIsInJldmVydEVkaXRzIiwiaW5kZXhPZiIsInJlbW92ZVRvZG8iLCJkZWxldGUiLCJzYXZlVG9kbyIsInB1dCIsInRvZ2dsZUNvbXBsZXRlZCIsImlzRGVmaW5lZCIsImNsZWFyQ29tcGxldGVkVG9kb3MiLCJjbGVhckNvbXBsZXRlZCIsIm1hcmtBbGwiLCJmb3JFYWNoIiwiZmFjdG9yeSIsIiRodHRwIiwiJGluamVjdG9yIiwiJHJlc291cmNlIiwiYXBpIiwidXBkYXRlIiwibWV0aG9kIiwib3JpZ2luYWxUb2RvcyIsInNsaWNlIiwiaW5jb21wbGV0ZVRvZG9zIiwiZmlsdGVyIiwiY29weSIsInNwbGljZSIsImlkIiwicXVlcnkiLCJyZXNwIiwic2F2ZSIsInB1c2giLCIkcHJvbWlzZSIsIiRxIiwiX2dldEZyb21Mb2NhbFN0b3JhZ2UiLCJkZWZlcnJlZCIsImRlZmVyIiwicHJvbWlzZSIsIl9zYXZlVG9Mb2NhbFN0b3JhZ2UiLCJzZXQiLCJyZXNwb25zZSIsImluZGV4IiwiZGlyZWN0aXZlIiwiJHRpbWVvdXQiLCJzY29wZSIsImVsZW0iLCJhdHRycyIsInRvZG9Gb2N1cyIsIm5ld1ZhbCIsImZvY3VzIiwiRVNDQVBFX0tFWSIsImJpbmQiLCJrZXlDb2RlIiwidG9kb0VzY2FwZSIsInVuYmluZCJdLCJtYXBwaW5ncyI6IkFBT0FBLFFBQUFDLE9BQUEsV0FBQSxVQUFBLGFBQUEsZUFDQUMsUUFBQSxpQkFBQSx1QkFBQSxTQUFBQyxFQUFBQyxHQUNBLFlBRUEsSUFBQUMsSUFDQUMsV0FBQSxXQUNBQyxZQUFBLHFCQUNBQyxTQUNBQyxPQUFBLGNBQUEsU0FBQUMsR0FFQSxNQUFBQSxHQUFBQyxLQUFBLFNBQUFWLEdBRUEsTUFEQUEsR0FBQVcsTUFDQVgsT0FNQUUsR0FDQVUsS0FBQSxJQUFBUixHQUNBUSxLQUFBLFdBQUFSLEdBQ0FTLFdBQ0FDLFdBQUEsTUFHQVgsRUFBQVksc0JBQ0EsT0FDQSwyQ0MzQkFoQixRQUFBQyxPQUFBLFdBQ0FLLFdBQUEsWUFBQSxTQUFBLGVBQUEsVUFBQSxRQUFBLE9BQUEsU0FBQVcsRUFBQUMsRUFBQUMsRUFBQVYsRUFBQVcsR0FDQSxZQUVBLElBQUFDLEdBQUFKLEVBQUFJLE1BQUFaLEVBQUFZLEtBQ0FDLFNBQUFDLElBQUFGLEdBRUFHLE9BQUFDLFFBQUFDLEtBQUFkLEtBQUFlLFNBQUEsR0FBQUMsU0FBQSxJQUFBLFNBQUFDLEdBQ0FaLEVB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R0FDQUYsRUFBQWpFLE9BQUFtRSxFQUFBQyxVQUFBLFNBQUFDLEdBQ0FBLEdBQ0FMLEVBQUEsV0FDQUUsRUFBQSxHQUFBSSxTQUNBLEdBQUEsU0NUQXpHLFFBQUFDLE9BQUEsV0FDQWlHLFVBQUEsY0FBQSxXQUNBLFlBRUEsSUFBQVEsR0FBQSxFQUVBLE9BQUEsVUFBQU4sRUFBQUMsRUFBQUMsR0FDQUQsRUFBQU0sS0FBQSxVQUFBLFNBQUFwRCxHQUNBQSxFQUFBcUQsVUFBQUYsR0FDQU4sRUFBQXBFLE9BQUFzRSxFQUFBTyxjQUlBVCxFQUFBM0QsSUFBQSxXQUFBLFdBQ0E0RCxFQUFBUyxPQUFBIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qZ2xvYmFsIGFuZ3VsYXIgKi9cblxuLyoqXG4gKiBUaGUgbWFpbiBUb2RvTVZDIGFwcCBtb2R1bGVcbiAqXG4gKiBAdHlwZSB7YW5ndWxhci5Nb2R1bGV9XG4gKi9cbmFuZ3VsYXIubW9kdWxlKCd0b2RvbXZjJywgWyduZ1JvdXRlJywgJ25nUmVzb3VyY2UnLCAnbmdTYW5pdGl6ZSddKVxuXHQuY29uZmlnKFsnJHJvdXRlUHJvdmlkZXInLCAnJHNjZURlbGVnYXRlUHJvdmlkZXInLCBmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIsICRzY2VEZWxlZ2F0ZVByb3ZpZGVyKSB7XG5cdFx0J3VzZSBzdHJpY3QnO1xuXG5cdFx0dmFyIHJvdXRlQ29uZmlnID0ge1xuXHRcdFx0Y29udHJvbGxlcjogJ1RvZG9DdHJsJyxcblx0XHRcdHRlbXBsYXRlVXJsOiAndG9kb212Yy1pbmRleC5odG1sJyxcblx0XHRcdHJlc29sdmU6IHtcblx0XHRcdFx0c3RvcmU6IFsndG9kb1N0b3JhZ2UnLCBmdW5jdGlvbiAodG9kb1N0b3JhZ2UpIHtcblx0XHRcdFx0XHQvLyBHZXQgdGhlIGNvcnJlY3QgbW9kdWxlIChBUEkgb3IgbG9jYWxTdG9yYWdlKS5cblx0XHRcdFx0XHRyZXR1cm4gdG9kb1N0b3JhZ2UudGhlbihmdW5jdGlvbiAobW9kdWxlKSB7XG5cdFx0XHRcdFx0XHRtb2R1bGUuZ2V0KCk7IC8vIEZldGNoIHRoZSB0b2RvIHJlY29yZHMgaW4gdGhlIGJhY2tncm91bmQuXG5cdFx0XHRcdFx0XHRyZXR1cm4gbW9kdWxlO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XVxuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQkcm91dGVQcm92aWRlclxuXHRcdFx0LndoZW4oJy8nLCByb3V0ZUNvbmZpZylcblx0XHRcdC53aGVuKCcvOnN0YXR1cycsIHJvdXRlQ29uZmlnKVxuXHRcdFx0Lm90aGVyd2lzZSh7XG5cdFx0XHRcdHJlZGlyZWN0VG86ICcvJ1xuXHRcdFx0fSk7XG5cbiAgICAkc2NlRGVsZWdhdGVQcm92aWRlci5yZXNvdXJjZVVybFdoaXRlbGlzdChbXG4gICAgICAnc2VsZicsXG4gICAgICAnKjovL2NhbGVuZGFyLmdvb2dsZS5jb20vY2FsZW5kYXIvKionXG4gICAgXSk7XG5cdH1dKTtcbiIsIi8qZ2xvYmFsIGFuZ3VsYXIgKi9cblxuLyoqXG4gKiBUaGUgbWFpbiBjb250cm9sbGVyIGZvciB0aGUgYXBwLiBUaGUgY29udHJvbGxlcjpcbiAqIC0gcmV0cmlldmVzIGFuZCBwZXJzaXN0cyB0aGUgbW9kZWwgdmlhIHRoZSB0b2RvU3RvcmFnZSBzZXJ2aWNlXG4gKiAtIGV4cG9zZXMgdGhlIG1vZGVsIHRvIHRoZSB0ZW1wbGF0ZSBhbmQgcHJvdmlkZXMgZXZlbnQgaGFuZGxlcnNcbiAqL1xuYW5ndWxhci5tb2R1bGUoJ3RvZG9tdmMnKVxuXHQuY29udHJvbGxlcignVG9kb0N0cmwnLCBbJyRzY29wZScsICckcm91dGVQYXJhbXMnLCAnJGZpbHRlcicsICdzdG9yZScsICckc2NlJywgZnVuY3Rpb24oJHNjb3BlLCAkcm91dGVQYXJhbXMsICRmaWx0ZXIsIHN0b3JlLCAkc2NlKSB7XG5cdFx0J3VzZSBzdHJpY3QnO1xuXG5cdFx0dmFyIHRvZG9zID0gJHNjb3BlLnRvZG9zID0gc3RvcmUudG9kb3M7XG4gICAgY29uc29sZS5sb2codG9kb3MpO1xuICAgIFxuICAgIGNocm9tZS5zdG9yYWdlLnN5bmMuZ2V0KHtjYWxlbmRhcjogJycsIHRhc2tsaXN0OiAnJ30sIGZ1bmN0aW9uKGl0ZW1zKSB7XG4gICAgICAkc2NvcGUuY2FsZW5kYXJTcmMgPSAnaHR0cHM6Ly9jYWxlbmRhci5nb29nbGUuY29tL2NhbGVuZGFyL2VtYmVkP3NyYz0nICsgaXRlbXMuY2FsZW5kYXI7XG4gICAgICAkc2NvcGUuY2FsZW5kYXIgPSAkc2NlLnRydXN0QXNSZXNvdXJjZVVybCgkc2NvcGUuY2FsZW5kYXJTcmMpO1xuICAgICAgLy8gY29uc29sZS5sb2coJHNjb3BlLmNhbGVuZGFyKTtcbiAgICAgICRzY29wZS4kYXBwbHkoKTtcbiAgICB9KTtcblxuXHRcdCRzY29wZS5uZXdUb2RvID0gJyc7XG5cdFx0JHNjb3BlLmVkaXRlZFRvZG8gPSBudWxsO1xuXG5cdFx0JHNjb3BlLiR3YXRjaCgndG9kb3MnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHQkc2NvcGUucmVtYWluaW5nQ291bnQgPSAkZmlsdGVyKCdmaWx0ZXInKSh0b2RvcywgeyBjb21wbGV0ZWQ6IGZhbHNlIH0pLmxlbmd0aDtcblx0XHRcdCRzY29wZS5jb21wbGV0ZWRDb3VudCA9IHRvZG9zLmxlbmd0aCAtICRzY29wZS5yZW1haW5pbmdDb3VudDtcblx0XHRcdCRzY29wZS5hbGxDaGVja2VkID0gISRzY29wZS5yZW1haW5pbmdDb3VudDtcblx0XHR9LCB0cnVlKTtcblxuXHRcdC8vIE1vbml0b3IgdGhlIGN1cnJlbnQgcm91dGUgZm9yIGNoYW5nZXMgYW5kIGFkanVzdCB0aGUgZmlsdGVyIGFjY29yZGluZ2x5LlxuXHRcdCRzY29wZS4kb24oJyRyb3V0ZUNoYW5nZVN1Y2Nlc3MnLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHR2YXIgc3RhdHVzID0gJHNjb3BlLnN0YXR1cyA9ICRyb3V0ZVBhcmFtcy5zdGF0dXMgfHwgJyc7XG5cdFx0XHQkc2NvcGUuc3RhdHVzRmlsdGVyID0gKHN0YXR1cyA9PT0gJ2FjdGl2ZScpID9cblx0XHRcdFx0eyBjb21wbGV0ZWQ6IGZhbHNlIH0gOiAoc3RhdHVzID09PSAnY29tcGxldGVkJykgP1xuXHRcdFx0XHR7IGNvbXBsZXRlZDogdHJ1ZSB9IDoge307XG5cdFx0fSk7XG5cblx0XHQkc2NvcGUuYWRkVG9kbyA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdHZhciBuZXdUb2RvID0ge1xuXHRcdFx0XHR0aXRsZTogJHNjb3BlLm5ld1RvZG8udHJpbSgpLFxuXHRcdFx0XHRjb21wbGV0ZWQ6IGZhbHNlXG5cdFx0XHR9O1xuXG5cdFx0XHRpZiAoIW5ld1RvZG8udGl0bGUpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHQkc2NvcGUuc2F2aW5nID0gdHJ1ZTtcblx0XHRcdHN0b3JlLmluc2VydChuZXdUb2RvKVxuXHRcdFx0XHQudGhlbihmdW5jdGlvbiBzdWNjZXNzKCkge1xuXHRcdFx0XHRcdCRzY29wZS5uZXdUb2RvID0gJyc7XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5maW5hbGx5KGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0XHQkc2NvcGUuc2F2aW5nID0gZmFsc2U7XG5cdFx0XHRcdH0pO1xuXHRcdH07XG5cblx0XHQkc2NvcGUuZWRpdFRvZG8gPSBmdW5jdGlvbiAodG9kbykge1xuXHRcdFx0JHNjb3BlLmVkaXRlZFRvZG8gPSB0b2RvO1xuXHRcdFx0Ly8gQ2xvbmUgdGhlIG9yaWdpbmFsIHRvZG8gdG8gcmVzdG9yZSBpdCBvbiBkZW1hbmQuXG5cdFx0XHQkc2NvcGUub3JpZ2luYWxUb2RvID0gYW5ndWxhci5leHRlbmQoe30sIHRvZG8pO1xuXHRcdH07XG5cblx0XHQkc2NvcGUuc2F2ZUVkaXRzID0gZnVuY3Rpb24gKHRvZG8sIGV2ZW50KSB7XG5cdFx0XHQvLyBCbHVyIGV2ZW50cyBhcmUgYXV0b21hdGljYWxseSB0cmlnZ2VyZWQgYWZ0ZXIgdGhlIGZvcm0gc3VibWl0IGV2ZW50LlxuXHRcdFx0Ly8gVGhpcyBkb2VzIHNvbWUgdW5mb3J0dW5hdGUgbG9naWMgaGFuZGxpbmcgdG8gcHJldmVudCBzYXZpbmcgdHdpY2UuXG5cdFx0XHRpZiAoZXZlbnQgPT09ICdibHVyJyAmJiAkc2NvcGUuc2F2ZUV2ZW50ID09PSAnc3VibWl0Jykge1xuXHRcdFx0XHQkc2NvcGUuc2F2ZUV2ZW50ID0gbnVsbDtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHQkc2NvcGUuc2F2ZUV2ZW50ID0gZXZlbnQ7XG5cblx0XHRcdGlmICgkc2NvcGUucmV2ZXJ0ZWQpIHtcblx0XHRcdFx0Ly8gVG9kbyBlZGl0cyB3ZXJlIHJldmVydGVkLS0gZG9uJ3Qgc2F2ZS5cblx0XHRcdFx0JHNjb3BlLnJldmVydGVkID0gbnVsbDtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR0b2RvLnRpdGxlID0gdG9kby50aXRsZS50cmltKCk7XG5cblx0XHRcdGlmICh0b2RvLnRpdGxlID09PSAkc2NvcGUub3JpZ2luYWxUb2RvLnRpdGxlKSB7XG5cdFx0XHRcdCRzY29wZS5lZGl0ZWRUb2RvID0gbnVsbDtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRzdG9yZVt0b2RvLnRpdGxlID8gJ3B1dCcgOiAnZGVsZXRlJ10odG9kbylcblx0XHRcdFx0LnRoZW4oZnVuY3Rpb24gc3VjY2VzcygpIHt9LCBmdW5jdGlvbiBlcnJvcigpIHtcblx0XHRcdFx0XHR0b2RvLnRpdGxlID0gJHNjb3BlLm9yaWdpbmFsVG9kby50aXRsZTtcblx0XHRcdFx0fSlcblx0XHRcdFx0LmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdCRzY29wZS5lZGl0ZWRUb2RvID0gbnVsbDtcblx0XHRcdFx0fSk7XG5cdFx0fTtcblxuXHRcdCRzY29wZS5yZXZlcnRFZGl0cyA9IGZ1bmN0aW9uICh0b2RvKSB7XG5cdFx0XHR0b2Rvc1t0b2Rvcy5pbmRleE9mKHRvZG8pXSA9ICRzY29wZS5vcmlnaW5hbFRvZG87XG5cdFx0XHQkc2NvcGUuZWRpdGVkVG9kbyA9IG51bGw7XG5cdFx0XHQkc2NvcGUub3JpZ2luYWxUb2RvID0gbnVsbDtcblx0XHRcdCRzY29wZS5yZXZlcnRlZCA9IHRydWU7XG5cdFx0fTtcblxuXHRcdCRzY29wZS5yZW1vdmVUb2RvID0gZnVuY3Rpb24gKHRvZG8pIHtcblx0XHRcdHN0b3JlLmRlbGV0ZSh0b2RvKTtcblx0XHR9O1xuXG5cdFx0JHNjb3BlLnNhdmVUb2RvID0gZnVuY3Rpb24gKHRvZG8pIHtcblx0XHRcdHN0b3JlLnB1dCh0b2RvKTtcblx0XHR9O1xuXG5cdFx0JHNjb3BlLnRvZ2dsZUNvbXBsZXRlZCA9IGZ1bmN0aW9uICh0b2RvLCBjb21wbGV0ZWQpIHtcblx0XHRcdGlmIChhbmd1bGFyLmlzRGVmaW5lZChjb21wbGV0ZWQpKSB7XG5cdFx0XHRcdHRvZG8uY29tcGxldGVkID0gY29tcGxldGVkO1xuXHRcdFx0fVxuXHRcdFx0c3RvcmUucHV0KHRvZG8sIHRvZG9zLmluZGV4T2YodG9kbykpXG5cdFx0XHRcdC50aGVuKGZ1bmN0aW9uIHN1Y2Nlc3MoKSB7fSwgZnVuY3Rpb24gZXJyb3IoKSB7XG5cdFx0XHRcdFx0dG9kby5jb21wbGV0ZWQgPSAhdG9kby5jb21wbGV0ZWQ7XG5cdFx0XHRcdH0pO1xuXHRcdH07XG5cblx0XHQkc2NvcGUuY2xlYXJDb21wbGV0ZWRUb2RvcyA9IGZ1bmN0aW9uICgpIHtcblx0XHRcdHN0b3JlLmNsZWFyQ29tcGxldGVkKCk7XG5cdFx0fTtcblxuXHRcdCRzY29wZS5tYXJrQWxsID0gZnVuY3Rpb24gKGNvbXBsZXRlZCkge1xuXHRcdFx0dG9kb3MuZm9yRWFjaChmdW5jdGlvbiAodG9kbykge1xuXHRcdFx0XHRpZiAodG9kby5jb21wbGV0ZWQgIT09IGNvbXBsZXRlZCkge1xuXHRcdFx0XHRcdCRzY29wZS50b2dnbGVDb21wbGV0ZWQodG9kbywgY29tcGxldGVkKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fTtcblx0fV0pO1xuIiwiLypnbG9iYWwgYW5ndWxhciAqL1xuXG4vKipcbiAqIFNlcnZpY2VzIHRoYXQgcGVyc2lzdHMgYW5kIHJldHJpZXZlcyB0b2RvcyBmcm9tIGxvY2FsU3RvcmFnZSBvciBhIGJhY2tlbmQgQVBJXG4gKiBpZiBhdmFpbGFibGUuXG4gKlxuICogVGhleSBib3RoIGZvbGxvdyB0aGUgc2FtZSBBUEksIHJldHVybmluZyBwcm9taXNlcyBmb3IgYWxsIGNoYW5nZXMgdG8gdGhlXG4gKiBtb2RlbC5cbiAqL1xuYW5ndWxhci5tb2R1bGUoJ3RvZG9tdmMnKVxuXHQuZmFjdG9yeSgndG9kb1N0b3JhZ2UnLCBbJyRodHRwJywgJyRpbmplY3RvcicsIGZ1bmN0aW9uICgkaHR0cCwgJGluamVjdG9yKSB7XG5cdFx0J3VzZSBzdHJpY3QnO1xuXG5cdFx0Ly8gRGV0ZWN0IGlmIGFuIEFQSSBiYWNrZW5kIGlzIHByZXNlbnQuIElmIHNvLCByZXR1cm4gdGhlIEFQSSBtb2R1bGUsIGVsc2Vcblx0XHQvLyBoYW5kIG9mZiB0aGUgbG9jYWxTdG9yYWdlIGFkYXB0ZXJcblx0XHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpJylcblx0XHRcdC50aGVuKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0cmV0dXJuICRpbmplY3Rvci5nZXQoJ2FwaScpO1xuXHRcdFx0fSwgZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRyZXR1cm4gJGluamVjdG9yLmdldCgnbG9jYWxTdG9yYWdlJyk7XG5cdFx0XHR9KTtcblx0fV0pXG5cblx0LmZhY3RvcnkoJ2FwaScsIFsnJHJlc291cmNlJywgZnVuY3Rpb24gKCRyZXNvdXJjZSkge1xuXHRcdCd1c2Ugc3RyaWN0JztcblxuXHRcdHZhciBzdG9yZSA9IHtcblx0XHRcdHRvZG9zOiBbXSxcblxuXHRcdFx0YXBpOiAkcmVzb3VyY2UoJy9hcGkvdG9kb3MvOmlkJywgbnVsbCxcblx0XHRcdFx0e1xuXHRcdFx0XHRcdHVwZGF0ZTogeyBtZXRob2Q6J1BVVCcgfVxuXHRcdFx0XHR9XG5cdFx0XHQpLFxuXG5cdFx0XHRjbGVhckNvbXBsZXRlZDogZnVuY3Rpb24gKCkge1xuXHRcdFx0XHR2YXIgb3JpZ2luYWxUb2RvcyA9IHN0b3JlLnRvZG9zLnNsaWNlKDApO1xuXG5cdFx0XHRcdHZhciBpbmNvbXBsZXRlVG9kb3MgPSBzdG9yZS50b2Rvcy5maWx0ZXIoZnVuY3Rpb24gKHRvZG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gIXRvZG8uY29tcGxldGVkO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRhbmd1bGFyLmNvcHkoaW5jb21wbGV0ZVRvZG9zLCBzdG9yZS50b2Rvcyk7XG5cblx0XHRcdFx0cmV0dXJuIHN0b3JlLmFwaS5kZWxldGUoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdH0sIGZ1bmN0aW9uIGVycm9yKCkge1xuXHRcdFx0XHRcdFx0YW5ndWxhci5jb3B5KG9yaWdpbmFsVG9kb3MsIHN0b3JlLnRvZG9zKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdH0sXG5cblx0XHRcdGRlbGV0ZTogZnVuY3Rpb24gKHRvZG8pIHtcblx0XHRcdFx0dmFyIG9yaWdpbmFsVG9kb3MgPSBzdG9yZS50b2Rvcy5zbGljZSgwKTtcblxuXHRcdFx0XHRzdG9yZS50b2Rvcy5zcGxpY2Uoc3RvcmUudG9kb3MuaW5kZXhPZih0b2RvKSwgMSk7XG5cdFx0XHRcdHJldHVybiBzdG9yZS5hcGkuZGVsZXRlKHsgaWQ6IHRvZG8uaWQgfSxcblx0XHRcdFx0XHRmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0fSwgZnVuY3Rpb24gZXJyb3IoKSB7XG5cdFx0XHRcdFx0XHRhbmd1bGFyLmNvcHkob3JpZ2luYWxUb2Rvcywgc3RvcmUudG9kb3MpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0fSxcblxuXHRcdFx0Z2V0OiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdHJldHVybiBzdG9yZS5hcGkucXVlcnkoZnVuY3Rpb24gKHJlc3ApIHtcblx0XHRcdFx0XHRhbmd1bGFyLmNvcHkocmVzcCwgc3RvcmUudG9kb3MpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0sXG5cblx0XHRcdGluc2VydDogZnVuY3Rpb24gKHRvZG8pIHtcblx0XHRcdFx0dmFyIG9yaWdpbmFsVG9kb3MgPSBzdG9yZS50b2Rvcy5zbGljZSgwKTtcblxuXHRcdFx0XHRyZXR1cm4gc3RvcmUuYXBpLnNhdmUodG9kbyxcblx0XHRcdFx0XHRmdW5jdGlvbiBzdWNjZXNzKHJlc3ApIHtcblx0XHRcdFx0XHRcdHRvZG8uaWQgPSByZXNwLmlkO1xuXHRcdFx0XHRcdFx0c3RvcmUudG9kb3MucHVzaCh0b2RvKTtcblx0XHRcdFx0XHR9LCBmdW5jdGlvbiBlcnJvcigpIHtcblx0XHRcdFx0XHRcdGFuZ3VsYXIuY29weShvcmlnaW5hbFRvZG9zLCBzdG9yZS50b2Rvcyk7XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHQuJHByb21pc2U7XG5cdFx0XHR9LFxuXG5cdFx0XHRwdXQ6IGZ1bmN0aW9uICh0b2RvKSB7XG5cdFx0XHRcdHJldHVybiBzdG9yZS5hcGkudXBkYXRlKHsgaWQ6IHRvZG8uaWQgfSwgdG9kbylcblx0XHRcdFx0XHQuJHByb21pc2U7XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdHJldHVybiBzdG9yZTtcblx0fV0pXG5cblx0LmZhY3RvcnkoJ2xvY2FsU3RvcmFnZScsIFsnJHEnLCBmdW5jdGlvbiAoJHEpIHtcblx0XHQndXNlIHN0cmljdCc7XG5cblx0XHQvLyB2YXIgU1RPUkFHRV9JRCA9ICd0b2Rvcy1hbmd1bGFyanMnO1xuXG5cdFx0dmFyIHN0b3JlID0ge1xuXHRcdFx0dG9kb3M6IFtdLFxuXG4gICAgICBfZ2V0RnJvbUxvY2FsU3RvcmFnZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgY2hyb21lLnN0b3JhZ2Uuc3luYy5nZXQoe3RvZG9zOiBbXX0sIGZ1bmN0aW9uKGl0ZW1zKSB7XG4gICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShpdGVtcy50b2Rvcyk7XG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICB9LFxuXG4gICAgICBfc2F2ZVRvTG9jYWxTdG9yYWdlOiBmdW5jdGlvbih0b2Rvcykge1xuICAgICAgICBjaHJvbWUuc3RvcmFnZS5zeW5jLnNldCh7dG9kb3M6IHRvZG9zfSk7XG4gICAgICB9LFxuICAgICAgLypcbiAgICAgICAgVGhpcyBpcyB0aGUgb3JpZ2luYWwgbG9jYWxTdG9yYWdlIGFwaSwgcmVwbGFjZWQgd2l0aCBjaHJvbWUuc3RvcmVcblxuXHRcdFx0X2dldEZyb21Mb2NhbFN0b3JhZ2U6IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0cmV0dXJuIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oU1RPUkFHRV9JRCkgfHwgJ1tdJyk7XG5cdFx0XHR9LFxuXG5cdFx0XHRfc2F2ZVRvTG9jYWxTdG9yYWdlOiBmdW5jdGlvbiAodG9kb3MpIHtcblx0XHRcdFx0bG9jYWxTdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9JRCwgSlNPTi5zdHJpbmdpZnkodG9kb3MpKTtcblx0XHRcdH0sXG5cbiAgICAgICovXG5cdFx0XHRjbGVhckNvbXBsZXRlZDogZnVuY3Rpb24gKCkge1xuXHRcdFx0XHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG5cdFx0XHRcdHZhciBpbmNvbXBsZXRlVG9kb3MgPSBzdG9yZS50b2Rvcy5maWx0ZXIoZnVuY3Rpb24gKHRvZG8pIHtcblx0XHRcdFx0XHRyZXR1cm4gIXRvZG8uY29tcGxldGVkO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRhbmd1bGFyLmNvcHkoaW5jb21wbGV0ZVRvZG9zLCBzdG9yZS50b2Rvcyk7XG5cblx0XHRcdFx0c3RvcmUuX3NhdmVUb0xvY2FsU3RvcmFnZShzdG9yZS50b2Rvcyk7XG5cdFx0XHRcdGRlZmVycmVkLnJlc29sdmUoc3RvcmUudG9kb3MpO1xuXG5cdFx0XHRcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXHRcdFx0fSxcblxuXHRcdFx0ZGVsZXRlOiBmdW5jdGlvbiAodG9kbykge1xuXHRcdFx0XHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG5cdFx0XHRcdHN0b3JlLnRvZG9zLnNwbGljZShzdG9yZS50b2Rvcy5pbmRleE9mKHRvZG8pLCAxKTtcblxuXHRcdFx0XHRzdG9yZS5fc2F2ZVRvTG9jYWxTdG9yYWdlKHN0b3JlLnRvZG9zKTtcblx0XHRcdFx0ZGVmZXJyZWQucmVzb2x2ZShzdG9yZS50b2Rvcyk7XG5cblx0XHRcdFx0cmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cdFx0XHR9LFxuXG5cdFx0XHRnZXQ6IGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICBzdG9yZS5fZ2V0RnJvbUxvY2FsU3RvcmFnZSgpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICBhbmd1bGFyLmNvcHkocmVzcG9uc2UsIHN0b3JlLnRvZG9zKTtcbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHN0b3JlLnRvZG9zKTtcbiAgICAgICAgfSk7XG5cblx0XHRcdFx0cmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cdFx0XHR9LFxuXG5cdFx0XHRpbnNlcnQ6IGZ1bmN0aW9uICh0b2RvKSB7XG5cdFx0XHRcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cblx0XHRcdFx0c3RvcmUudG9kb3MucHVzaCh0b2RvKTtcblxuXHRcdFx0XHRzdG9yZS5fc2F2ZVRvTG9jYWxTdG9yYWdlKHN0b3JlLnRvZG9zKTtcblx0XHRcdFx0ZGVmZXJyZWQucmVzb2x2ZShzdG9yZS50b2Rvcyk7XG5cblx0XHRcdFx0cmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cdFx0XHR9LFxuXG5cdFx0XHRwdXQ6IGZ1bmN0aW9uICh0b2RvLCBpbmRleCkge1xuXHRcdFx0XHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG5cdFx0XHRcdHN0b3JlLnRvZG9zW2luZGV4XSA9IHRvZG87XG5cblx0XHRcdFx0c3RvcmUuX3NhdmVUb0xvY2FsU3RvcmFnZShzdG9yZS50b2Rvcyk7XG5cdFx0XHRcdGRlZmVycmVkLnJlc29sdmUoc3RvcmUudG9kb3MpO1xuXG5cdFx0XHRcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHRyZXR1cm4gc3RvcmU7XG5cdH1dKTtcbiIsIi8qZ2xvYmFsIGFuZ3VsYXIgKi9cblxuLyoqXG4gKiBEaXJlY3RpdmUgdGhhdCBwbGFjZXMgZm9jdXMgb24gdGhlIGVsZW1lbnQgaXQgaXMgYXBwbGllZCB0byB3aGVuIHRoZVxuICogZXhwcmVzc2lvbiBpdCBiaW5kcyB0byBldmFsdWF0ZXMgdG8gdHJ1ZVxuICovXG5hbmd1bGFyLm1vZHVsZSgndG9kb212YycpXG5cdC5kaXJlY3RpdmUoJ3RvZG9Gb2N1cycsIFsnJHRpbWVvdXQnLCBmdW5jdGlvbigkdGltZW91dCkge1xuXHRcdCd1c2Ugc3RyaWN0JztcblxuXHRcdHJldHVybiBmdW5jdGlvbiAoc2NvcGUsIGVsZW0sIGF0dHJzKSB7XG5cdFx0XHRzY29wZS4kd2F0Y2goYXR0cnMudG9kb0ZvY3VzLCBmdW5jdGlvbiAobmV3VmFsKSB7XG5cdFx0XHRcdGlmIChuZXdWYWwpIHtcblx0XHRcdFx0XHQkdGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdFx0XHRlbGVtWzBdLmZvY3VzKCk7XG5cdFx0XHRcdFx0fSwgMCwgZmFsc2UpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9O1xuXHR9XSk7XG4iLCIvKmdsb2JhbCBhbmd1bGFyICovXG5cbi8qKlxuICogRGlyZWN0aXZlIHRoYXQgZXhlY3V0ZXMgYW4gZXhwcmVzc2lvbiB3aGVuIHRoZSBlbGVtZW50IGl0IGlzIGFwcGxpZWQgdG8gZ2V0c1xuICogYW4gYGVzY2FwZWAga2V5ZG93biBldmVudC5cbiAqL1xuYW5ndWxhci5tb2R1bGUoJ3RvZG9tdmMnKVxuXHQuZGlyZWN0aXZlKCd0b2RvRXNjYXBlJywgW2Z1bmN0aW9uICgpIHtcblx0XHQndXNlIHN0cmljdCc7XG5cblx0XHR2YXIgRVNDQVBFX0tFWSA9IDI3O1xuXG5cdFx0cmV0dXJuIGZ1bmN0aW9uIChzY29wZSwgZWxlbSwgYXR0cnMpIHtcblx0XHRcdGVsZW0uYmluZCgna2V5ZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xuXHRcdFx0XHRpZiAoZXZlbnQua2V5Q29kZSA9PT0gRVNDQVBFX0tFWSkge1xuXHRcdFx0XHRcdHNjb3BlLiRhcHBseShhdHRycy50b2RvRXNjYXBlKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdGVsZW0udW5iaW5kKCdrZXlkb3duJyk7XG5cdFx0XHR9KTtcblx0XHR9O1xuXHR9XSk7XG4iXX0=
